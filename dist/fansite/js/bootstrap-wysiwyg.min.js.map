{"version":3,"sources":["bootstrap-wysiwyg.js"],"names":["$","readFileIntoDataUrl","fileInfo","loader","Deferred","fReader","FileReader","onload","e","resolve","target","result","onerror","reject","onprogress","notify","readAsDataURL","promise","fn","cleanHtml","html","this","replace","wysiwyg","userOptions","selectedRange","options","toolbarBtnSelector","editor","updateToolbar","activeToolbarClass","toolbarSelector","find","each","command","data","commandRole","document","queryCommandState","addClass","removeClass","execCommand","commandWithArgs","valueArg","commandArr","split","shift","args","join","getCurrentRange","sel","window","getSelection","getRangeAt","rangeCount","saveSelection","restoreSelection","selection","removeAllRanges","ex","body","createTextRange","select","empty","addRange","insertFiles","files","focus","idx","test","type","when","done","dataUrl","fail","fileUploadError","markSelection","input","color","queryCommandSupported","selectionMarker","bindToolbar","toolbar","click","on","newValue","value","selectionColor","change","length","initFileDrops","dataTransfer","originalEvent","stopPropagation","preventDefault","extend","defaults","dragAndDropImages","attr","bind","isInside","is","has","currentRange","clear","startContainer","endContainer","startOffset","endOffset","hotKeys","ctrl+b meta+b","ctrl+i meta+i","ctrl+u meta+u","ctrl+z meta+z","ctrl+y meta+y meta+shift+z","ctrl+l meta+l","ctrl+r meta+r","ctrl+e meta+e","ctrl+j meta+j","shift+tab","tab","reason","detail","console","log","jQuery"],"mappings":"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","file":"bootstrap-wysiwyg.min.js","sourcesContent":["/* http://github.com/mindmup/bootstrap-wysiwyg */\r\n/*global jQuery, $, FileReader*/\r\n/*jslint browser:true*/\r\n(function ($) {\r\n\t'use strict';\r\n\tvar readFileIntoDataUrl = function (fileInfo) {\r\n\t\tvar loader = $.Deferred(),\r\n\t\t\tfReader = new FileReader();\r\n\t\tfReader.onload = function (e) {\r\n\t\t\tloader.resolve(e.target.result);\r\n\t\t};\r\n\t\tfReader.onerror = loader.reject;\r\n\t\tfReader.onprogress = loader.notify;\r\n\t\tfReader.readAsDataURL(fileInfo);\r\n\t\treturn loader.promise();\r\n\t};\r\n\t$.fn.cleanHtml = function () {\r\n\t\tvar html = $(this).html();\r\n\t\treturn html && html.replace(/(<br>|\\s|<div><br><\\/div>|&nbsp;)*$/, '');\r\n\t};\r\n\t$.fn.wysiwyg = function (userOptions) {\r\n\t\tvar editor = this,\r\n\t\t\tselectedRange,\r\n\t\t\toptions,\r\n\t\t\ttoolbarBtnSelector,\r\n\t\t\tupdateToolbar = function () {\r\n\t\t\t\tif (options.activeToolbarClass) {\r\n\t\t\t\t\t$(options.toolbarSelector).find(toolbarBtnSelector).each(function () {\r\n\t\t\t\t\t\tvar command = $(this).data(options.commandRole);\r\n\t\t\t\t\t\tif (document.queryCommandState(command)) {\r\n\t\t\t\t\t\t\t$(this).addClass(options.activeToolbarClass);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$(this).removeClass(options.activeToolbarClass);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\texecCommand = function (commandWithArgs, valueArg) {\r\n\t\t\t\tvar commandArr = commandWithArgs.split(' '),\r\n\t\t\t\t\tcommand = commandArr.shift(),\r\n\t\t\t\t\targs = commandArr.join(' ') + (valueArg || '');\r\n\t\t\t\tdocument.execCommand(command, 0, args);\r\n\t\t\t\tupdateToolbar();\r\n\t\t\t},\r\n\t\t\tbindHotkeys = function (hotKeys) {\r\n\t\t\t\t$.each(hotKeys, function (hotkey, command) {\r\n\t\t\t\t\teditor.keydown(hotkey, function (e) {\r\n\t\t\t\t\t\tif (editor.attr('contenteditable') && editor.is(':visible')) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\texecCommand(command);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).keyup(hotkey, function (e) {\r\n\t\t\t\t\t\tif (editor.attr('contenteditable') && editor.is(':visible')) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tgetCurrentRange = function () {\r\n\t\t\t\tvar sel = window.getSelection();\r\n\t\t\t\tif (sel.getRangeAt && sel.rangeCount) {\r\n\t\t\t\t\treturn sel.getRangeAt(0);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsaveSelection = function () {\r\n\t\t\t\tselectedRange = getCurrentRange();\r\n\t\t\t},\r\n\t\t\trestoreSelection = function () {\r\n\t\t\t\tvar selection = window.getSelection();\r\n\t\t\t\tif (selectedRange) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tselection.removeAllRanges();\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\tdocument.body.createTextRange().select();\r\n\t\t\t\t\t\tdocument.selection.empty();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tselection.addRange(selectedRange);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tinsertFiles = function (files) {\r\n\t\t\t\teditor.focus();\r\n\t\t\t\t$.each(files, function (idx, fileInfo) {\r\n\t\t\t\t\tif (/^image\\//.test(fileInfo.type)) {\r\n\t\t\t\t\t\t$.when(readFileIntoDataUrl(fileInfo)).done(function (dataUrl) {\r\n\t\t\t\t\t\t\texecCommand('insertimage', dataUrl);\r\n\t\t\t\t\t\t}).fail(function (e) {\r\n\t\t\t\t\t\t\toptions.fileUploadError(\"file-reader\", e);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\toptions.fileUploadError(\"unsupported-file-type\", fileInfo.type);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tmarkSelection = function (input, color) {\r\n\t\t\t\trestoreSelection();\r\n\t\t\t\tif (document.queryCommandSupported('hiliteColor')) {\r\n\t\t\t\t\tdocument.execCommand('hiliteColor', 0, color || 'transparent');\r\n\t\t\t\t}\r\n\t\t\t\tsaveSelection();\r\n\t\t\t\tinput.data(options.selectionMarker, color);\r\n\t\t\t},\r\n\t\t\tbindToolbar = function (toolbar, options) {\r\n\t\t\t\ttoolbar.find(toolbarBtnSelector).click(function () {\r\n\t\t\t\t\trestoreSelection();\r\n\t\t\t\t\teditor.focus();\r\n\t\t\t\t\texecCommand($(this).data(options.commandRole));\r\n\t\t\t\t\tsaveSelection();\r\n\t\t\t\t});\r\n\t\t\t\ttoolbar.find('[data-toggle=dropdown]').click(restoreSelection);\r\n\r\n\t\t\t\ttoolbar.find('input[type=text][data-' + options.commandRole + ']').on('webkitspeechchange change', function () {\r\n\t\t\t\t\tvar newValue = this.value; /* ugly but prevents fake double-calls due to selection restoration */\r\n\t\t\t\t\tthis.value = '';\r\n\t\t\t\t\trestoreSelection();\r\n\t\t\t\t\tif (newValue) {\r\n\t\t\t\t\t\teditor.focus();\r\n\t\t\t\t\t\texecCommand($(this).data(options.commandRole), newValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsaveSelection();\r\n\t\t\t\t}).on('focus', function () {\r\n\t\t\t\t\tvar input = $(this);\r\n\t\t\t\t\tif (!input.data(options.selectionMarker)) {\r\n\t\t\t\t\t\tmarkSelection(input, options.selectionColor);\r\n\t\t\t\t\t\tinput.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}).on('blur', function () {\r\n\t\t\t\t\tvar input = $(this);\r\n\t\t\t\t\tif (input.data(options.selectionMarker)) {\r\n\t\t\t\t\t\tmarkSelection(input, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\ttoolbar.find('input[type=file][data-' + options.commandRole + ']').change(function () {\r\n\t\t\t\t\trestoreSelection();\r\n\t\t\t\t\tif (this.type === 'file' && this.files && this.files.length > 0) {\r\n\t\t\t\t\t\tinsertFiles(this.files);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsaveSelection();\r\n\t\t\t\t\tthis.value = '';\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tinitFileDrops = function () {\r\n\t\t\t\teditor.on('dragenter dragover', false)\r\n\t\t\t\t\t.on('drop', function (e) {\r\n\t\t\t\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tif (dataTransfer && dataTransfer.files && dataTransfer.files.length > 0) {\r\n\t\t\t\t\t\t\tinsertFiles(dataTransfer.files);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t};\r\n\t\toptions = $.extend({}, $.fn.wysiwyg.defaults, userOptions);\r\n\t\ttoolbarBtnSelector = 'a[data-' + options.commandRole + '],button[data-' + options.commandRole + '],input[type=button][data-' + options.commandRole + ']';\r\n\t\t//bindHotkeys(options.hotKeys);\r\n\t\tif (options.dragAndDropImages) {\r\n\t\t\tinitFileDrops();\r\n\t\t}\r\n\t\tbindToolbar($(options.toolbarSelector), options);\r\n\t\teditor.attr('contenteditable', true)\r\n\t\t\t.on('mouseup keyup mouseout', function () {\r\n\t\t\t\tsaveSelection();\r\n\t\t\t\tupdateToolbar();\r\n\t\t\t});\r\n\t\t$(window).bind('touchend', function (e) {\r\n\t\t\tvar isInside = (editor.is(e.target) || editor.has(e.target).length > 0),\r\n\t\t\t\tcurrentRange = getCurrentRange(),\r\n\t\t\t\tclear = currentRange && (currentRange.startContainer === currentRange.endContainer && currentRange.startOffset === currentRange.endOffset);\r\n\t\t\tif (!clear || isInside) {\r\n\t\t\t\tsaveSelection();\r\n\t\t\t\tupdateToolbar();\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn this;\r\n\t};\r\n\t$.fn.wysiwyg.defaults = {\r\n\t\thotKeys: {\r\n\t\t\t'ctrl+b meta+b': 'bold',\r\n\t\t\t'ctrl+i meta+i': 'italic',\r\n\t\t\t'ctrl+u meta+u': 'underline',\r\n\t\t\t'ctrl+z meta+z': 'undo',\r\n\t\t\t'ctrl+y meta+y meta+shift+z': 'redo',\r\n\t\t\t'ctrl+l meta+l': 'justifyleft',\r\n\t\t\t'ctrl+r meta+r': 'justifyright',\r\n\t\t\t'ctrl+e meta+e': 'justifycenter',\r\n\t\t\t'ctrl+j meta+j': 'justifyfull',\r\n\t\t\t'shift+tab': 'outdent',\r\n\t\t\t'tab': 'indent'\r\n\t\t},\r\n\t\ttoolbarSelector: '[data-role=editor-toolbar]',\r\n\t\tcommandRole: 'edit',\r\n\t\tactiveToolbarClass: 'btn-info',\r\n\t\tselectionMarker: 'edit-focus-marker',\r\n\t\tselectionColor: 'darkgrey',\r\n\t\tdragAndDropImages: true,\r\n\t\tfileUploadError: function (reason, detail) { console.log(\"File upload error\", reason, detail); }\r\n\t};\r\n}(window.jQuery));\r\n"],"sourceRoot":"/source/"}